import{f as R,r as i,e as y,b as v,a as B,o as M,j as e,c as q,k as O,B as b,v as z,w as D,L as V}from"./browser-ByRVlxZs.js";import{I as G}from"./input-b4JxTlpn.js";import{Q as W}from"./animated-logo-m8857RJK.js";import{S as Y,a as H}from"./provider-metadata-CugWU6eq.js";import{A as U}from"./arrow-right-jlGWHuiZ.js";import{A as J}from"./arrow-left-DQqK4Wmi.js";/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],X=R("circle-check",K);function ie({modal:s=!1,mode:m="signin",onClose:l}){const[x,o]=i.useState(m),[r,F]=i.useState(null),[c,N]=i.useState(""),[S,C]=i.useState("invite"),[g,I]=i.useState(!1),[j,n]=i.useState(null),[L,k]=i.useState(!1),{mutateAsync:Q}=y(v.auth.signInSocial.mutationOptions()),{mutateAsync:T}=y(v.auth.validateBetaInvite.mutationOptions()),{mutate:A}=y(v.tabs.close.mutationOptions()),d=x==="signup",u=d&&S==="invite",f=d&&S==="auth",_=s&&!u&&!f;i.useEffect(()=>{(async()=>{try{if(u&&!c){const h=(await navigator.clipboard.readText()).trim();h.toLowerCase().startsWith("qu-")&&(N(h),k(!0))}}catch{}})()},[]);const{data:p,isFetched:E}=B(v.user.live.me.experimental_liveOptions({}));i.useEffect(()=>{p?.error?F(p.error.code):p&&E&&(l?.(),M.dismiss(),!s&&window.api.tabId&&A({id:window.api.tabId}))},[p,E,s,l,A]);const P=async t=>{if(t.preventDefault(),u){I(!0),n(null);try{const[a]=await Promise.all([T({code:c.trim()}),new Promise(h=>setTimeout(h,2e3))]);a.valid?C("auth"):n(a.error?.message||"Invalid invite code")}catch(a){n(a instanceof Error?a.message:"Failed to validate invite code")}finally{I(!1)}}else try{await Q({inviteCode:c})}catch(a){D?.captureException(a)}};return e.jsxs("div",{className:q("flex flex-col gap-6"),children:[e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsxs("a",{className:"flex flex-col items-center gap-2 font-medium",href:"#",children:[e.jsx("div",{className:"mb-2 flex h-16 w-16 items-center justify-center rounded-md",children:e.jsx(W,{size:64})}),e.jsx("span",{className:"sr-only",children:"Quests"})]}),e.jsx("h1",{className:"text-3xl font-bold mb-2",children:d?"Sign up for Quests":"Sign in to Quests"}),r&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:r===401?e.jsxs(e.Fragment,{children:["You don't have access to Quests yet. Please join the"," ",e.jsx("a",{className:"underline underline-offset-4 hover:text-primary",href:"https://quests.dev/waitlist",rel:"noopener noreferrer",target:"_blank",children:"waitlist"}),"."]}):"There was an error signing in."}),u&&!r&&e.jsxs("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:["Quests is currently in private beta. Paste your invite code below or"," ",e.jsx("a",{className:"underline underline-offset-4 hover:text-primary",href:"https://quests.dev",rel:"noopener noreferrer",target:"_blank",children:"join the waitlist"}),"."]}),f&&!r&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:"Great! Now continue with Google to complete your account setup."}),_&&e.jsx("p",{className:"text-sm text-muted-foreground text-center max-w-md",children:"You need to be signed in to use Quests AI features."})]}),u&&!r&&e.jsxs("form",{className:"w-full max-w-md mx-auto",onSubmit:t=>{P(t)},children:[e.jsxs("div",{className:"flex relative",children:[e.jsx(G,{className:"grow font-mono pl-12 text-center bg-muted/30 border-border/50 focus:bg-muted/50 transition-colors pr-12",disabled:g,id:"invite-code",onChange:t=>{N(t.target.value),n(null),k(!1)},placeholder:"Enter your invite code",required:!0,type:"text",value:c}),e.jsx("button",{className:"absolute right-0 top-0 bottom-0 bg-primary text-primary-foreground flex justify-center items-center px-3 py-2 m-1 rounded-md hover:bg-primary/90 transition-all disabled:opacity-50",disabled:!c.trim()||g,type:"submit",children:g?e.jsx(O,{className:"h-4 w-4 animate-spin"}):e.jsx(U,{className:"h-4 w-4"})})]}),L&&!j&&e.jsxs("p",{className:"text-xs mt-2 text-center flex items-center justify-center gap-1",children:[e.jsx(X,{className:"h-4 w-4"}),"Invite code filled from clipboard"]}),j&&e.jsx("p",{className:"text-destructive text-sm mt-2 text-center",children:j})]}),(f||!d)&&!r&&e.jsxs("div",{className:"flex flex-col items-center justify-center gap-3",children:[e.jsxs("form",{className:"flex items-center justify-center gap-3 relative",onSubmit:t=>{P(t)},children:[f&&e.jsx(b,{className:"text-sm text-muted-foreground hover:text-foreground absolute -left-12",onClick:()=>{C("invite"),n(null)},size:"sm",type:"button",variant:"ghost",children:e.jsx(J,{className:"h-4 w-4"})}),e.jsxs(b,{className:"w-full min-w-80",type:"submit",variant:"default",children:[e.jsx("svg",{viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .307 5.387.307 12s5.56 12 12.173 12c3.573 0 6.267-1.173 8.373-3.36 2.16-2.16 2.84-5.213 2.84-7.667 0-.76-.053-1.467-.173-2.053H12.48z",fill:"currentColor"})}),"Continue with Google"]})]}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"or"}),e.jsx("div",{className:"flex items-center justify-center gap-3 relative",children:e.jsxs(b,{className:"w-full min-w-80",onClick:()=>{z.preferences.openSettingsWindow({showNewProviderDialog:!0,tab:"Providers"}),l?.()},type:"button",variant:"outline",children:[e.jsx("div",{className:"flex items-center gap-1 mr-2",children:Y.map(({type:t})=>e.jsx(H,{className:"size-4",type:t},t))}),"Add an AI Provider"]})})]})]}),e.jsx("div",{className:"text-center",children:r?e.jsx("p",{className:"text-sm text-muted-foreground",children:e.jsx(w,{className:"underline underline-offset-4 hover:text-primary",modal:s,onModeChange:t=>{o(t),n(null)},to:"/register",children:"Return to sign up"})}):d?e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx(w,{className:"underline underline-offset-4 hover:text-primary",modal:s,onModeChange:t=>{o(t),n(null)},to:"/login",children:"Sign in"})]}):e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Don't have an account?"," ",e.jsx(w,{className:"underline underline-offset-4 hover:text-primary",modal:s,onModeChange:t=>{o(t),n(null)},to:"/register",children:"Sign up"})]})}),e.jsxs("div",{className:"text-balance text-center text-xs text-muted-foreground [&_a]:underline [&_a]:underline-offset-4 hover:[&_a]:text-primary border-t border-border/50 pt-6",children:["By clicking continue, you agree to our"," ",e.jsx("a",{href:"https://quests.dev/terms-of-service",children:"Terms of Service"})," and"," ",e.jsx("a",{href:"https://quests.dev/privacy-policy",children:"Privacy Policy"}),"."]})]})}function w({children:s,className:m,modal:l,onModeChange:x,to:o}){if(l&&x){const r=o==="/login"?"signin":"signup";return e.jsx("button",{className:m,onClick:()=>{x(r)},type:"button",children:s})}return e.jsx(V,{className:m,to:o,children:s})}export{ie as L};
