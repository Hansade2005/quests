import{a4 as A,r as i,a5 as R,a6 as w}from"./browser-ByRVlxZs.js";const S={},x=i.createContext(void 0);function v(t){return i.useContext(x)||R()}const g=t=>typeof t?.then=="function",h=t=>{t.status||(t.status="pending",t.then(o=>{t.status="fulfilled",t.value=o},o=>{t.status="rejected",t.reason=o}))},P=A.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(h(t),t)}),b=new WeakMap,_=(t,o)=>{let u=b.get(t);return u||(u=new Promise((r,n)=>{let l=t;const f=e=>s=>{l===e&&r(s)},d=e=>s=>{l===e&&n(s)},c=()=>{try{const e=o();g(e)?(b.set(e,u),l=e,e.then(f(e),d(e)),w(e,c)):r(e)}catch(e){n(e)}};t.then(f(t),d(t)),w(t,c)}),b.set(t,u)),u};function y(t,o){const{delay:u,unstable_promiseStatus:r=!A.use}={},n=v(),[[l,f,d],c]=i.useReducer(s=>{const a=n.get(t);return Object.is(s[0],a)&&s[1]===n&&s[2]===t?s:[a,n,t]},void 0,()=>[n.get(t),n,t]);let e=l;if((f!==n||d!==t)&&(c(),e=n.get(t)),i.useEffect(()=>{const s=n.sub(t,()=>{if(r)try{const a=n.get(t);g(a)&&h(_(a,()=>n.get(t)))}catch{}if(typeof u=="number"){setTimeout(c,u);return}c()});return c(),s},[n,t,u,r]),i.useDebugValue(e),g(e)){const s=_(e,()=>n.get(t));return r&&h(s),P(s)}return e}function C(t,o){const u=v();return i.useCallback((...n)=>{if((S?"production":void 0)!=="production"&&!("write"in t))throw new Error("not writable atom");return u.set(t,...n)},[u,t])}function F(t,o){return[y(t),C(t)]}export{y as a,F as u};
